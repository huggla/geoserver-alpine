# Set in stage2:
# ---------------------------------------------------------
# set -e +a +m +s +i -f
# isFirstRun
# VAR_*
# All functions in /start/functions

if [ "$isFirstRun" == "true" ] && [ -n "$VAR_DATA_DIR" ] && [ "$VAR_DATA_DIR" != "/usr/local/tomcat/webapps/geoserver/data" ]
then
   local dataDirPoint="$(sed -n '/GEOSERVER_DATA_DIR/{=;q;}' '/usr/local/tomcat/webapps/geoserver/WEB-INF/web.xml')"
   local start="$(expr $dataDirPoint - 2)"
   local end="$(expr $dataDirPoint + 3)"
   sed -i "${start}d;${end}d" '/usr/local/tomcat/webapps/geoserver/WEB-INF/web.xml'
   local str='C:\eclipse\workspace\geoserver_trunk\cite\confCiteWFSPostGIS'
   sed -i "s|$str|'$VAR_DATA_DIR'|" '/usr/local/tomcat/webapps/geoserver/WEB-INF/web.xml'
   if [ ! -s "$VAR_DATA_DIR" ]
   then
      mv "/usr/local/tomcat/webapps/geoserver/data" "$VAR_DATA_DIR"
   fi
fi
